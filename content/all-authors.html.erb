---
title: Les auteurs
layout: default
---

<h2>Tous les auteurs</h2>

<%
require 'digest'

PALETTE = %w[
  #e57373 #f06292 #ba68c8 #9575cd #7986cb
  #64b5f6 #4fc3f7 #4dd0e1 #4db6ac #81c784
  #aed581 #dce775 #fff176 #ffd54f #ffb74d
].freeze

def stable_index(name, n)
  Digest::MD5.hexdigest(name.to_s).to_i(16) % n
end

def color_for_name_from_palette(name)
  PALETTE[stable_index(name, PALETTE.length)]
end

def color_for_name_hsl(name, saturation: 60, lightness: 50)
  h = Digest::MD5.hexdigest(name.to_s).to_i(16) % 360
  hsl_to_hex(h, saturation, lightness)
end

def hsl_to_hex(h, s, l)
  s /= 100.0; l /= 100.0
  c = (1 - (2*l - 1).abs) * s
  x = c * (1 - ((h / 60.0) % 2 - 1).abs)
  m = l - c/2.0

  r1, g1, b1 =
    case h
    when 0...60  then [c, x, 0]
    when 60...120 then [x, c, 0]
    when 120...180 then [0, c, x]
    when 180...240 then [0, x, c]
    when 240...300 then [x, 0, c]
    else [c, 0, x]
    end

  r = ((r1 + m) * 255).round
  g = ((g1 + m) * 255).round
  b = ((b1 + m) * 255).round

  format("#%02x%02x%02x", r, g, b)
end

def luminance(hex)
  r, g, b = hex.scan(/../).map { |c| c.to_i(16) / 255.0 }

  [r, g, b].map! do |v|
    v <= 0.03928 ? v / 12.92 : ((v + 0.055) / 1.055) ** 2.4
  end

  0.2126 * r + 0.7152 * g + 0.0722 * b
end

def foreground_for(bg_hex)
  luminance(bg_hex) > 0.179 ? "#000000" : "#ffffff"
end
%>

<ul class="tag-cloud">
<% author_tag_cloud.each do |author, tag_weight, books_count| %>
  <%
  background_color = color_for_name_from_palette(author)
  # background_color = color_for_name_hsl(author)
  foreground_color = foreground_for(background_color)
  %>
  <li>
    <span class="tag-container tag_<%= tag_weight %>">
      <a href="<%= @items[author_item_identifier(author)].path %>"><span class="tag-pic" style="<%= "--avatar-fallback-foreground: #{foreground_color}; --avatar-fallback-background: #{background_color};" %>"><%= author[0] %></span>&nbsp;<span class="tag"><%= author %></span></a>&nbsp;<span class="tag-count">(<%= books_count %>)</span>
    </span>
  </li>
<% end %>
</ul>
